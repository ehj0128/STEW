# 기술공부(일자별 정리)

## 7/20

### Git rule

#### Commit Message

[<type>(F/B)] <기능, 메세지>, <Jira key>

메세지 내용

>Feat(Feature) - 기능 추가 등
>
>Fix - 버그수정
>
>Docs(Document) - 문서 추가, 수정
>
>Style - 포맷, 세미콜론 등 기능변경이 아닌 문법 수정
>
>Refactor - 기능의 변경이 아닌 코드의 구조가 변경되었을 때
>
>Test - 테스트 내용 추가

#### Branch

Branch 종류

>Master
>
>Hotfix - 제품에서 발생한 버그를 수정
>
>Develop - 출시 버전을 개발
>
>Feature - Develop의 하위 브랜치, 기능을 개발

Naming 규칙

><branch 종류>-<Front | Back>-<Action>

### webRTC Study

[RTCMultiConnection](https://www.rtcmulticonnection.org/docs/getting-started/)에 소스를 이용하여 room-id를 입력하여 화상회의로 입장할 수 있는 방을 구현함

```html
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div class="videos-container"></div>
  <input id="txt-roomid" placeholder="Unique room ID">
  <button id="btn-open-or-join-room">open or join</button>
  <script src="https://cdn.jsdelivr.net/npm/rtcmulticonnection@latest/dist/RTCMultiConnection.min.js"></script>
  <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
  <script>
    var connection = new RTCMultiConnection()
    connection.socketURL = 'https://rtcmulticonnection.herokuapp.com:443/'
    connection.session = {
      audio: true,
      video: true,
      data: true
    }
    connection.sdpConstraints.mandatory = {
      OfferToReceiveAudio: true,
      OfferToReceiveVideo: true,
    }

    var roomID = document.getElementById('txt-roomid')
    roomID.value = connection.token()
    document.getElementById('btn-open-or-join-room').onclick = function () {
      // this.disabled = true
      connection.openOrJoin(roomID.value)
    }

  </script>
</body>

</html>
```

이후 학습내용

1. 방을 퇴장하는 방법
2. study아이디를 room-id로 사용하는 방법
3. video-tag배치
4. socket server(?)구현 

## 7/21

### webRTC Study

어제의 보안내용 중 해결 한 내용

1. 방을 퇴장하는 방법

   ```js
   connection.getAllParticipants().forEach((participantId) => {
     connection.disconnectWith(participantId);
   });  // getAllParticipants 접속한 사람들과 각각 연결을 끊어야함
   connection.attachStreams.forEach(function(localStream) {
     localStream.stop();
   });  // 비디오를 종료하는 로직
   connection.closeSocket(); // close socket.io connection
   ```

2. study아이디를 room-id로 사용하는 방법

   * Vue에서 사용할 때 data에 study-group의 id를 넣어놓고 자동으로 입장하게 구현 가능 

추가학습

```html
<div class="videos-container"></div>
<script>
    connection.videosContainer = document.querySelector('.videos-container');
    // 방에 입장하게 되면 자동으로 생성되는 video태그를 원하는 태그에 집어넣을 수 있다. 
</script>

```

이후 학습내용

1. video-tag배치
2. socket server(?)필요성 및 구현

### Vue - webRTC 연동

vue에서 webRTC를 사용해 보고 동작이 되는지 확인해 보았다.

프로젝트에서 사용하는 vuex, router, typescript를 기본으로 설정하여 프로젝트를 생성하고 새로운 camstudy.vue를 제작하였다..

> 작업과정

1. CDN넣기

    vue파일에 CDN을 직접 넣는 방법을 찾지 못함.

   ```html
   <script src="https://cdn.jsdelivr.net/npm/rtcmulticonnection@latest/dist/RTCMultiConnection.min.js"></script>
   <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
   ```

   먼저 두 줄을 `template`와 `script`사이에 적어준다.(왜 적어야 하는지는 모르겠다. 안적으면 오류가 발생)

   그 후 mounted에 createElement를 이용해 CDN을 생성해준다.

   ```js
   mounted() {
       let cdn1 = document.createElement("script");
       cdn1.setAttribute(
         "src",
         "https://cdn.jsdelivr.net/npm/rtcmulticonnection@latest/dist/RTCMultiConnection.min.js"
       );
       cdn1.setAttribute("id", "cdn1");
       document.body.appendChild(cdn1);
       let cdn2 = document.createElement("script");
       cdn2.setAttribute(
         "src",
         "https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"
       );
       cdn2.setAttribute("id", "cdn2");
       document.body.appendChild(cdn2);
     },
   ```

   위의 과정이 없으면 페이지 자체에서 new RTCMultiConnection()에 대한 정의가 되어있지 않다.

2. 이전에 제작한 방을 생성하는 로직 넣기

   data부분에 connection을 정의하고 이후 `this.connection = new RTCMultiConnection();` 으로 connection을 변경하여 사용

   openRoom을 methods에 정의

   ```js
   openRoom() {
     this.connection = new RTCMultiConnection();
   
     this.connection.session = {
       audio: true,
       video: true,
       data: true
     };
   
     this.connection.socketURL =
       "https://rtcmulticonnection.herokuapp.com:443/";
   
     this.connection.sdpConstraints.mandatory = {
       OfferToReceiveAudio: true,
       OfferToReceiveVideo: true
     };
     this.connection.openOrJoin(this.roomid);
     this.connection.videosContainer = document.querySelector(
       ".videos-container"
     );
   },
   ```

3. 퇴장하는 로직 생성

   ```js
   outRoom() {      
     this.connection.getAllParticipants().forEach((participantId) => {
       this.connection.disconnectWith(participantId);
     });
   
     this.connection.attachStreams.forEach(function(localStream) {
       localStream.stop();
     });
   
     this.connection.closeSocket();
   }
   ```

4. CDN제거

   다른페이지로 가더라도 기존 CDN이 남아있게되고 다시 올때마다 CDN이 중첩되어 생성된다.

   따라서 다른 페이지로 가게되면 CDN을 제거해주어야한다.

   ```js
   destroyed() {
     // cdn 제거
     var el1 = document.querySelector("#cdn1");
     el1.remove();
     var el2 = document.querySelector("#cdn2");
     el2.remove();
   }
   ```

5. 전체코드

   ```vue
   <template>
     <div>
       <div class="videos-container"></div>
       <input v-model="roomid" placeholder="Unique room ID" />
       <button @click="openRoom()">open or join</button>
       <button @click="outRoom()">퇴장</button>
     </div>
   </template>
   <script src="https://cdn.jsdelivr.net/npm/rtcmulticonnection@latest/dist/RTCMultiConnection.min.js"></script>
   <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
   
   <script>
   export default {
     name: "Camstudy",
     mounted() {
       let cdn1 = document.createElement("script");
       cdn1.setAttribute(
         "src",
         "https://cdn.jsdelivr.net/npm/rtcmulticonnection@latest/dist/RTCMultiConnection.min.js"
       );
       cdn1.setAttribute("id", "cdn1");
       document.body.appendChild(cdn1);
       let cdn2 = document.createElement("script");
       cdn2.setAttribute(
         "src",
         "https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"
       );
       cdn2.setAttribute("id", "cdn2");
       document.body.appendChild(cdn2);
     },
     data() {
       return {
         roomid: "",
         connection: null
       };
     },
     methods: {
       openRoom() {
         this.connection = new RTCMultiConnection();
   
         this.connection.session = {
           audio: true,
           video: true,
           data: true
         };
   
         this.connection.socketURL =
           "https://rtcmulticonnection.herokuapp.com:443/";
   
         this.connection.sdpConstraints.mandatory = {
           OfferToReceiveAudio: true,
           OfferToReceiveVideo: true
         };
         this.connection.openOrJoin(this.roomid);
         this.connection.videosContainer = document.querySelector(
           ".videos-container"
         );
       },
       outRoom() {      
         this.connection.getAllParticipants().forEach((participantId) => {
           this.connection.disconnectWith(participantId);
         });
   
         this.connection.attachStreams.forEach(function(localStream) {
           localStream.stop();
         });
   
         this.connection.closeSocket();
       }
     },
   
     destroyed() {
       // cdn 제거
       var el1 = document.querySelector("#cdn1");
       el1.remove();
       var el2 = document.querySelector("#cdn2");
       el2.remove();
     }
   };
   </script>
   
   <style>
   </style>
   ```

6. 실제 페이지에서 적용되는지 위의 페이지만 netlify를 이용하여 확인해 보았다.

   [시범홈페이지](https://jovial-williams-1d4985.netlify.app)

## 7/22

### webRTC Study

1. socket server 구현

   * [socket 오픈소스 GIT](https://github.com/muaz-khan/RTCMultiConnection)이용

   * AWS에 background로 socket서버 구현

     ```bash
     # background 실행
     $ nohub node server.js &
     
     # socket주소
     #i3b103.p.ssafy.io:9001
     ```

2. 구현된 주소로 코드실행시 정상 작동!!

### Vuex Study

* [Vuex 공식문서](https://vuex.vuejs.org/kr/)

* 핵심컨셉까지 공부완료
* 어려운 내용이라 몇번 더 공부하고 써봐야 적용할 수 있을 것 같다.

## 7/23

### Vue-router Sutdy

* [vue-router 공식문서](https://router.vuejs.org/kr/)
* 공식문서를 읽으며 이전에 사용했던  vue-router에 관련된 코드들 확인

## 7/24

### 스터디표시 컴포넌트(카드형식)

* backend에서 study정보 나온 이후 제작 시작

### 화상스터디 컴포넌트

* 클릭 시 화상스터디 룸에 입장하는 기본 로직은 구현 완료!

* 추가 기능(음소거on/off 비디오on/off) 등 구현 필요

  ```html
  <template>
    <div>
      <h1>room</h1>
      <div class="videos-container"></div>
      <button @click="outRoom">퇴장</button>
      <button @click="mute">음소거</button>
      <button @click="unmute">소리켜기</button>
    </div>
  </template>
  <script src="https://cdn.jsdelivr.net/npm/rtcmulticonnection@latest/dist/RTCMultiConnection.min.js"></script>
  <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
  <script>
  export default {
    name: "Room",
    data() {
      return {
        roomid: "",
        connection: null,
      };
    },
    mounted() {
      this.connection = new RTCMultiConnection();
      this.connection.session = {
        audio: true,
        video: true,
        data: true,
      };
  
      // this.connection.socketURL = "http://i3b103.p.ssafy.io:9001/";
      this.connection.socketURL = "https://rtcmulticonnection.herokuapp.com:443/";
  
      this.connection.sdpConstraints.mandatory = {
        OfferToReceiveAudio: true,
        OfferToReceiveVideo: true,
      };
      this.connection.openOrJoin("abcd");
      this.connection.videosContainer = document.querySelector(
        ".videos-container"
      );
    },
    methods: {
      outRoom() {
        this.connection.getAllParticipants().forEach((participantId) => {
          this.connection.disconnectWith(participantId);
        });
  
        this.connection.attachStreams.forEach(function (localStream) {
          localStream.stop();
        });
  
        this.connection.closeSocket();
      },
      },
    },
    destroyed() {
      this.outRoom();
    },
  };
  </script>
  
  <style>
  </style>
  ```

  

다음주부터 frontend 본격적인 coding 및 각각 제작한 컴포넌트 합치기 작업예정